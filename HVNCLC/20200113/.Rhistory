m4_c4[is.na(m4_c4)] <- "total"
m4_c4[m4_c4$hvn_survey_id == "total",]$age_1_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_2_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_3_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_4_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_5_p <- 100.00
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_buy_place = 0,
age_1 = 0, age_1_p = 0,
age_2 = 0, age_2_p = 0,
age_3 = 0, age_3_p = 0,
age_4 = 0, age_4_p = 0,
age_5 = 0, age_5_p = 0,
total = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_buy_place = 0,
age_1 = 0, age_1_p = 0,
age_2 = 0, age_2_p = 0,
age_3 = 0, age_3_p = 0,
age_4 = 0, age_4_p = 0,
age_5 = 0, age_5_p = 0,
total = 0)
m4_c4 <- m4_c4 %>%
full_join(m4_choice_data, by = c("hvn_survey_id", "hvn_m_buy_place")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%
ungroup() %>%
select
m4_c4 <- m4_data %>%
mutate(age = 2021 - as.numeric(hvn_res_age),
age_group = case_when(age <= 25 ~ 1,
age > 25 & age <= 35 ~ 2,
age > 35 & age <= 45 ~ 3,
age > 45 & age <= 60 ~ 4,
age > 60 ~ 5)) %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_buy_place, age_group) %>%
summarise(n = n()) %>%
ungroup() %>%
spread(age_group, n) %>%
replace_na_with(0) %>%
ungroup() %>%
left_join(m4_group_total, by = "hvn_survey_id_num")
m4_c4 <- m4_c4 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m4_c4) %>%
ungroup() %>%
rename(age_1 = `1`,
age_2 = `2`,
age_3 = `3`,
age_4 = `4`,
age_5 = `5`) %>%
mutate(total = age_1 + age_2 + age_3 + age_4 + age_5) %>%
mutate(age_1_p = round(age_1 / group_total, 4) * 100,
age_2_p = round(age_2 / group_total, 4) * 100,
age_3_p = round(age_3 / group_total, 4) * 100,
age_4_p = round(age_4 / group_total, 4) * 100,
age_5_p = round(age_5 / group_total, 4) * 100) %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_buy_place,
age_1, age_1_p, age_2, age_2_p,
age_3, age_3_p, age_4, age_4_p, age_5, age_5_p, total)
m4_c4[is.na(m4_c4)] <- "total"
m4_c4[m4_c4$hvn_survey_id == "total",]$age_1_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_2_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_3_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_4_p <- 100.00
m4_c4[m4_c4$hvn_survey_id == "total",]$age_5_p <- 100.00
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_buy_place = 0,
age_1 = 0, age_1_p = 0,
age_2 = 0, age_2_p = 0,
age_3 = 0, age_3_p = 0,
age_4 = 0, age_4_p = 0,
age_5 = 0, age_5_p = 0,
total = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_buy_place = 0,
age_1 = 0, age_1_p = 0,
age_2 = 0, age_2_p = 0,
age_3 = 0, age_3_p = 0,
age_4 = 0, age_4_p = 0,
age_5 = 0, age_5_p = 0,
total = 0)
table_m4_c4 <- m4_c4 %>%
full_join(m4_choice_data, by = c("hvn_survey_id", "hvn_m_buy_place")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%
ungroup() %>%
select(-hvn_survey_id_num, -stt)
m4_c5 <- m4_data %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_buy_place, hvn_res_edu) %>%
summarise(n = n()) %>%
ungroup() %>%
spread(hvn_res_edu, n) %>%
replace_na_with(0) %>%
ungroup() %>%
left_join(m4_group_total, by = "hvn_survey_id_num")
m4_c5 <- m4_c5 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m4_c5) %>%
ungroup() %>%
rename(edu_1 = `1`,
edu_2 = `2`,
edu_3 = `3`) %>%
mutate(total = edu_1 + edu_2 + edu_3) %>%
mutate(edu_1_p = round(edu_1 / total, 4) * 100,
edu_2_p = round(edu_2 / total, 4) * 100,
edu_3_p = round(edu_3 / total, 4) * 100) %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_buy_place, edu_1, edu_1_p, edu_2, edu_2_p,
edu_3, edu_3_p, total)
m4_c5[is.na(m4_c5)] <- "total"
m4_c5[m4_c5$hvn_survey_id == "total",]$edu_1_p <- 100.00
m4_c5[m4_c5$hvn_survey_id == "total",]$edu_2_p <- 100.00
m4_c5[m4_c5$hvn_survey_id == "total",]$edu_3_p <- 100.00
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_buy_place = 0,
edu_1 = 0, edu_1_p = 0,
edu_2 = 0, edu_2_p = 0,
edu_3 = 0, edu_3_p = 0,
total = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_buy_place = 0,
edu_1 = 0, edu_1_p = 0,
edu_2 = 0, edu_2_p = 0,
edu_3 = 0, edu_3_p = 0,
total = 0)
table_m4_c5 <- m4_c5 %>%
full_join(m4_choice_data, by = c("hvn_survey_id", "hvn_m_buy_place")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%
ungroup() %>%
select(-hvn_survey_id_num, -stt)
m4_c8 <- m4_data %>%
mutate(hvn_city_id = case_when(!(hvn_city_id %in% c("1", "48", "79", "92")) ~ "997",
TRUE ~ hvn_city_id)) %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_buy_place, hvn_city_id) %>%
summarise(n = n()) %>%
ungroup() %>%
spread(hvn_city_id, n) %>%
replace_na_with(0) %>%
ungroup() %>%
left_join(m4_group_total, by = "hvn_survey_id_num")
m4_c8 <- m4_c8 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m4_c8) %>%
ungroup() %>%
rename(city_1 = `1`,
city_2 = `48`,
city_3 = `79`,
city_4 = `92`,
city_97 = `997`) %>%
mutate(total = city_1 + city_2 + city_3 +
city_4 + city_97) %>%
mutate(city_1_p = round(city_1 / group_total, 4) * 100,
city_2_p = round(city_2 / group_total, 4) * 100,
city_3_p = round(city_3 / group_total, 4) * 100,
city_4_p = round(city_4 / group_total, 4) * 100,
city_97_p = round(city_97 / group_total, 4) * 100) %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_buy_place,
city_1, city_1_p, city_2, city_2_p,
city_3, city_3_p, city_4, city_4_p, city_97, city_97_p, total)
m4_c8[is.na(m4_c8)] <- "total"
m4_c8[m4_c8$hvn_survey_id == "total",]$city_1_p <- 100.00
m4_c8[m4_c8$hvn_survey_id == "total",]$city_2_p <- 100.00
m4_c8[m4_c8$hvn_survey_id == "total",]$city_3_p <- 100.00
m4_c8[m4_c8$hvn_survey_id == "total",]$city_4_p <- 100.00
m4_c8[m4_c8$hvn_survey_id == "total",]$city_97_p <- 100.00
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_buy_place = 0,
city_1 = 0, city_1_p = 0,
city_2 = 0, city_2_p = 0,
city_3 = 0, city_3_p = 0,
city_4 = 0, city_4_p = 0,
city_97 = 0, city_97_p = 0,
total = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_buy_place = 0,
city_1 = 0, city_1_p = 0,
city_2 = 0, city_2_p = 0,
city_3 = 0, city_3_p = 0,
city_4 = 0, city_4_p = 0,
city_97 = 0, city_97_p = 0,
total = 0)
m4_c8 <- m4_c8 %>%
full_join(m4_choice_data, by = c("hvn_survey_id", "hvn_m_buy_place")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%   ungroup() %>%
select(-hvn_survey_id_num, -stt)
View(table_m4_c5)
m5_data <- data_full %>%
select(industry_certi_code, hvn_survey_id, hvn_product_id, hvn_m_info_source,
`_URI`, hvn_res_gender, hvn_res_age, hvn_res_edu,
hvn_res_income, hvn_res_job, hvn_city_id) %>%
mutate(hvn_survey_id_num = as.numeric(substring(hvn_survey_id, 3))) %>%
group_by(hvn_survey_id) %>%
filter(!duplicated(`_URI`)) %>%
mutate(group_total = n()) %>%
ungroup() %>%
separate_rows(hvn_m_info_source, sep = " ") %>%
mutate(hvn_m_info_source = as.numeric(hvn_m_info_source))
m5_choice_data <- m5_choice %>%
select(stt, survey_id, choice_id) %>%
rename(hvn_survey_id = survey_id,
hvn_m_info_source = choice_id,
stt = stt) %>%
mutate(hvn_m_info_source = as.numeric(hvn_m_info_source))
m5_group_total <- m5_data %>%
distinct(hvn_survey_id_num, group_total)
m5 <- m5_data %>%
select( hvn_survey_id, hvn_survey_id_num, group_total, hvn_m_info_source) %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source) %>%
mutate(n = n()) %>%
ungroup() %>%
distinct(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source, .keep_all = TRUE) %>%
group_by(hvn_survey_id) %>%
mutate(total = sum(n),
total_p = round(n / group_total, 4) * 100) %>%
ungroup()
m5 <- m5 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m5) %>%
ungroup() %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source,
n, total_p, total, group_total)
m5[is.na(m5)] <- "total"
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
m5 <- m5_data %>%
select( hvn_survey_id, hvn_survey_id_num, group_total, hvn_m_info_source) %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source) %>%
mutate(n = n()) %>%
ungroup() %>%
distinct(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source, .keep_all = TRUE) %>%
group_by(hvn_survey_id) %>%
mutate(total = sum(n),
total_p = round(n / group_total, 4) * 100) %>%
ungroup()
m5 <- m5 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m5) %>%
ungroup() %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source,
n, total_p, total, group_total)
m5[is.na(m5)] <- "total"
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
table_m5 <- m5 %>%
mutate(total_p = case_when(hvn_survey_id == "total" ~ 100,
TRUE ~ total_p)) %>%
full_join(m5_choice_data, by = c("hvn_survey_id", "hvn_m_info_source")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%
ungroup() %>%
select(-hvn_survey_id_num, -total, -group_total, -stt)
View(table_m5)
m5_data <- data_full %>%
select(industry_certi_code, hvn_survey_id, hvn_product_id, hvn_m_info_source,
`_URI`, hvn_res_gender, hvn_res_age, hvn_res_edu,
hvn_res_income, hvn_res_job, hvn_city_id) %>%
mutate(hvn_survey_id_num = as.numeric(substring(hvn_survey_id, 3))) %>%
group_by(hvn_survey_id) %>%
filter(!duplicated(`_URI`)) %>%
mutate(group_total = n()) %>%
ungroup() %>%
separate_rows(hvn_m_info_source, sep = " ") %>%
mutate(hvn_m_info_source = as.numeric(hvn_m_info_source))
m5_choice_data <- m5_choice %>%
select(stt, survey_id, choice_id) %>%
rename(hvn_survey_id = survey_id,
hvn_m_info_source = choice_id,
stt = stt) %>%
mutate(hvn_m_info_source = as.numeric(hvn_m_info_source))
m5_group_total <- m5_data %>%
distinct(hvn_survey_id_num, group_total)
#### Create table m5
m5 <- m5_data %>%
select( hvn_survey_id, hvn_survey_id_num, group_total, hvn_m_info_source) %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source) %>%
mutate(n = n()) %>%
ungroup() %>%
distinct(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source, .keep_all = TRUE) %>%
group_by(hvn_survey_id) %>%
mutate(total = sum(n),
total_p = round(n / group_total, 4) * 100) %>%
ungroup()
m5 <- m5 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m5) %>%
ungroup() %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source,
n, total_p, total, group_total)
m5[is.na(m5)] <- "total"
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
table_m5 <- m5 %>%
mutate(total_p = case_when(hvn_survey_id == "total" ~ 100,
TRUE ~ total_p)) %>%
full_join(m5_choice_data, by = c("hvn_survey_id", "hvn_m_info_source")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%
ungroup() %>%
select(-hvn_survey_id_num, -total, -group_total, -stt)
View(table_m5)
m5_data <- data_full %>%
select(industry_certi_code, hvn_survey_id, hvn_product_id, hvn_m_info_source,
`_URI`, hvn_res_gender, hvn_res_age, hvn_res_edu,
hvn_res_income, hvn_res_job, hvn_city_id) %>%
mutate(hvn_survey_id_num = as.numeric(substring(hvn_survey_id, 3)),
hvn_survey_id_num = case_when(hvn_survey_id_num == 11 &
industry_certi_code == 13 ~ 11.1,
hvn_survey_id_num == 11 &
(industry_certi_code == 16 |
industry_certi_code == 17)  ~ 11.2,
TRUE ~ hvn_survey_id_num
),
hvn_survey_id = case_when(hvn_survey_id_num == 11.1 ~ "MP11.1",
hvn_survey_id_num == 11.2 ~ "MP11.2",
TRUE ~ hvn_survey_id)) %>%
group_by(hvn_survey_id) %>%
filter(!duplicated(`_URI`)) %>%
mutate(group_total = n()) %>%
ungroup() %>%
separate_rows(hvn_m_info_source, sep = " ") %>%
mutate(hvn_m_info_source = as.numeric(hvn_m_info_source))
m5_choice_data <- m5_choice %>%
select(stt, survey_id, choice_id) %>%
rename(hvn_survey_id = survey_id,
hvn_m_info_source = choice_id,
stt = stt) %>%
mutate(hvn_m_info_source = as.numeric(hvn_m_info_source))
m5_group_total <- m5_data %>%
distinct(hvn_survey_id_num, group_total)
m5 <- m5_data %>%
select( hvn_survey_id, hvn_survey_id_num, group_total, hvn_m_info_source) %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source) %>%
mutate(n = n()) %>%
ungroup() %>%
distinct(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source, .keep_all = TRUE) %>%
group_by(hvn_survey_id) %>%
mutate(total = sum(n),
total_p = round(n / group_total, 4) * 100) %>%
ungroup()
m5 <- m5 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m5) %>%
ungroup() %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source,
n, total_p, total, group_total)
m5[is.na(m5)] <- "total"
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_info_source = 0,
n = 0,
total_p = 0)
table_m5 <- m5 %>%
mutate(total_p = case_when(hvn_survey_id == "total" ~ 100,
TRUE ~ total_p)) %>%
full_join(m5_choice_data, by = c("hvn_survey_id", "hvn_m_info_source")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%
ungroup() %>%
select(-hvn_survey_id_num, -total, -group_total, -stt)
View(table_m5)
m5_c3 <- m5_data %>%
group_by(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source, hvn_res_gender) %>%
summarise(n = n()) %>%
ungroup() %>%
spread(hvn_res_gender, n) %>%
replace_na_with(0) %>%
ungroup() %>%
left_join(m5_group_total, by = "hvn_survey_id_num")
m5_c3 <- m5_c3 %>%
group_by(hvn_survey_id_num) %>%
summarise_if(is.numeric, list(~ sum(., na.rm = TRUE))) %>%
bind_rows(m5_c3) %>%
ungroup() %>%
rename(male = `1`,
female = `2`) %>%
mutate(total = `male` + `female`,
male_p = round(male / group_total, 4) * 100,
female_p = round(female / group_total, 4) * 100) %>%
select(hvn_survey_id, hvn_survey_id_num, hvn_m_info_source,
male, male_p, female, female_p, total)
m5_c3[is.na(m5_c3)] <- "total"
m5_c3[m5_c3$hvn_survey_id == "total",]$male_p <- 100.00
m5_c3[m5_c3$hvn_survey_id == "total",]$female_p <- 100.00
missing_totalrow_MP16 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "16",
hvn_m_info_source = 0,
male = 0,
male_p = 0,
female = 0,
female_p = 0,
total = 0)
missing_totalrow_MP24 <- data.table(hvn_survey_id = "total",
hvn_survey_id_num = "24",
hvn_m_info_source = 0,
male = 0,
male_p = 0,
female = 0,
female_p = 0,
total = 0)
table_m5_c3 <- m5_c3 %>%
full_join(m5_choice_data, by = c("hvn_survey_id", "hvn_m_info_source")) %>%
mutate(hvn_survey_id_num =
replace(hvn_survey_id_num, is.na(hvn_survey_id_num),
str_sub(hvn_survey_id,3,-1)[is.na(hvn_survey_id_num)])) %>%
bind_rows(missing_totalrow_MP16, missing_totalrow_MP24) %>%
arrange(as.numeric(hvn_survey_id_num), stt) %>%
ungroup() %>%
select(-hvn_survey_id_num, -stt)
RTA::load_packages(readr, tidyr, dplyr, DT, RTA,
stringr, gsheet, data.table, lubridate)
###Get instance list to delete as per BSA request
NTD_delete <-  read.csv(text = gsheet2text("https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=1158660739", format = 'csv'), fileEncoding = "UTF-8", stringsAsFactors = FALSE)
## import data
survey_product_raw <- get_dm2_data("C1102", "HVN_PRODUCT_VOTE_2023_hvn_choice_rr_official", encoding = "UTF-8")  %>%
anti_join(NTD_delete, by = "instanceID")
survey_raw <- get_dm2_data("C1102", "HVN_PRODUCT_VOTE_2023_official_CORE")  %>%
anti_join(NTD_delete, by = "instanceID")
## -----------------------------------------------------------------------------
download_es_data <- function(index, post_body = "{}", host = "https://es.rta.vn", size = 10000, ...) {
if (missing(index)) {
stop("argument 'index' is not provided", call. = FALSE)
}
url <- URLencode(paste0(host, "/", index,
"/_data?format=csv&size=", size,
"&source_content_type=application/json",
"&source=", post_body))
df <- data.table::fread(url, quote = "\"",
colClasses = "character", data.table = FALSE,
showProgress = FALSE, ...)
df
}
companydb <- download_es_data("biz_register_product") %>%
distinct(biz_tax, .keep_all = TRUE) %>%
select(biz_tax, company_name, biz_add, contact_email, contact_phone)
View(companydb)
# get m3, m4 & m5 choices from ggsheet, instead of dm v2
# https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=964389200
ggs_m3m4m5 <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=964389200"
m3_m4_m5_choice <-  read.csv(text = gsheet2text(ggs_m3m4m5, format = 'csv'), fileEncoding = "UTF-8", stringsAsFactors = FALSE)
m3_choice <- m3_m4_m5_choice %>%
filter(mquestion == "m3")
m4_choice <- m3_m4_m5_choice %>%
filter(mquestion == "m4")
m5_choice <- m3_m4_m5_choice %>%
filter(mquestion == "m5")
