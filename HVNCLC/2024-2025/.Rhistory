ggs_rest_vne1 <- "https://docs.google.com/spreadsheets/d/1t8qzXJzaQ7juC8J9UNAd31fNfo2GXHUu9qjMrgqCEAM/edit#gid=1761326406"
ggs_rest_vne2 <- "https://docs.google.com/spreadsheets/d/1t8qzXJzaQ7juC8J9UNAd31fNfo2GXHUu9qjMrgqCEAM/edit#gid=1894765741"
rest_vne1 <-  read.csv(text = gsheet2text(ggs_rest_vne1, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 1)  %>%
arrange(phone) %>%
mutate(block_id = round(1 + round(row_number())/200)) %>%
mutate(source = paste0("VNexpress_1","_",block_id))
rest_vne2 <-  read.csv(text = gsheet2text(ggs_rest_vne2, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 1) %>%
arrange(phone) %>%
mutate(block_id = round(1 + round(row_number())/200)) %>%
mutate(source = paste0("VNexpress_2","_",block_id))
rest_vnexpress <- rbind(rest_vne1, rest_vne2)
# clean data
rest_vnexpress_clean <- rest_vnexpress %>%
filter(str_length(phone) == 10) %>%
filter(is.na(invalid) == TRUE) %>%
mutate(rep_name = str_to_title(rep_name)) %>%
mutate(crm_account_id = "",
crm_account_lb = biz_name,
crm_city_id = "",
crm_city_lb = city,
rep_name	= rep_name,
rep_title = position,
crm_email = email,
crm_phone1 = phone,
crm_source_id = source,
crm_source_ct = source,
crm_status_id = "",
crm_status_lb = "Đăng ký",
crm_describ = paste0(business,"; ",staff_size,"; ",challenges,"; ",experience),
instance_meta = "",
crm_tags = "") %>%
select(crm_account_id, crm_account_lb, crm_city_id, crm_city_lb, rep_name, rep_title, crm_email, crm_phone1,
crm_source_id, crm_source_ct, crm_status_id, crm_status_lb, crm_describ, instance_meta, crm_tags)
# write to temp git folder
export_path <- "/Volumes/WORK/rtGit/TrungLe/rnalytics/usaid-restaurant/"
write_xlsx(rest_vnexpress_clean, path = paste0(export_path,"rest_vnexpress_clean.xlsx"),   col_names = TRUE)
library(shiny)
library(shinyWidgets)
# data
cities <- data.frame(
continent = c("America", "America", "America", "Africa",
"Africa", "Africa", "Africa", "Africa",
"Europe", "Europe", "Europe", "Antarctica"),
country = c("Canada", "Canada", "USA", "Tunisia", "Tunisia",
"Tunisia", "Algeria", "Algeria", "Italy", "Germany", "Spain", NA),
city = c("Trois-Rivières", "Québec", "San Francisco", "Tunis",
"Monastir", "Sousse", "Alger", "Oran", "Rome", "Berlin", "Madrid", NA),
stringsAsFactors = FALSE
)
# app
ui <- fluidPage(
tags$h2("treeInput() example"),
fluidRow(
column(
width = 4,
treeInput(
inputId = "ID1",
label = "Select cities:",
choices = create_tree(cities),
# selected = "San Francisco",
returnValue = "text",
closeDepth = 0
),
verbatimTextOutput("res1")
),
column(
width = 4,
treeInput(
inputId = "ID2",
label = "Select cities:",
choices = create_tree(cities),
# selected = "San Francisco",
returnValue = "text",
closeDepth = 1
),
verbatimTextOutput("res2")
),
column(
width = 4,
treeInput(
inputId = "ID3",
label = "Select cities:",
choices = create_tree(cities),
# selected = "San Francisco",
returnValue = "text",
closeDepth = 2
),
verbatimTextOutput("res3")
)
)
)
server <- function(input, output, session) {
output$res1 <- renderPrint(input$ID1)
output$res2 <- renderPrint(input$ID2)
output$res3 <- renderPrint(input$ID3)
}
if (interactive())
shinyApp(ui, server)
library(shiny)
library(shinyWidgets)
# data
cities <- data.frame(
continent = c("America", "America", "America", "Africa",
"Africa", "Africa", "Africa", "Africa",
"Europe", "Europe", "Europe", "Antarctica"),
country = c("Canada", "Canada", "USA", "Tunisia", "Tunisia",
"Tunisia", "Algeria", "Algeria", "Italy", "Germany", "Spain", NA),
city = c("Trois-Rivières", "Québec", "San Francisco", "Tunis",
"Monastir", "Sousse", "Alger", "Oran", "Rome", "Berlin", "Madrid", NA),
stringsAsFactors = FALSE
)
# app
ui <- fluidPage(
tags$h2("treeInput() example"),
fluidRow(
column(
width = 4,
treeInput(
inputId = "ID1",
label = "Select cities:",
choices = create_tree(cities),
# selected = "San Francisco",
returnValue = "text",
closeDepth = 0
),
verbatimTextOutput("res1")
),
column(
width = 4,
treeInput(
inputId = "ID2",
label = "Select cities:",
choices = create_tree(cities),
# selected = "San Francisco",
returnValue = "text",
closeDepth = 1
),
verbatimTextOutput("res2")
),
column(
width = 4,
treeInput(
inputId = "ID3",
label = "Select cities:",
choices = create_tree(cities),
# selected = "San Francisco",
returnValue = "text",
closeDepth = 2
),
verbatimTextOutput("res3")
)
)
)
server <- function(input, output, session) {
output$res1 <- renderPrint(input$ID1)
output$res2 <- renderPrint(input$ID2)
output$res3 <- renderPrint(input$ID3)
}
if (interactive())
shinyApp(ui, server)
RTA::load_packages(readr, tidyr, dplyr, DT, RTA,
stringr, gsheet, data.table, lubridate)
# This script aim to create market report for HVNCLC 2020
# Purpose      :   Create market report for HVNCLC 2020
# Code         :
# Destination  :   [HVNCLC] Báo cáo TT thị trường khảo sát HVNCLC 2020 (S621)
# Author       :   rta_xuanle
# Editor       :
# Created      :   2019-01-13
# Updated      :   2019-
# Change       :
## IMPORT END - Do not remove or edit this line
## -----------------------------------------------------------------------------
## global setup
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE, comment = "", message = FALSE, warning = FALSE)
options(shiny.sanitize.errors = FALSE, scipen = 999, knitr.kable.NA = "")
Sys.setlocale(category = "LC_ALL", locale = "en_US.UTF-8")
## -----------------------------------------------------------------------------
## load packages
RTA::load_packages(readr, tidyr, dplyr, DT, RTA,
stringr, gsheet, data.table, lubridate)
## -----------------------------------------------------------------------------
download_es_data <- function(index, post_body = "{}", host = "https://es.rta.vn", size = 10000, ...) {
if (missing(index)) {
stop("argument 'index' is not provided", call. = FALSE)
}
url <- URLencode(paste0(host, "/", index,
"/_data?format=csv&size=", size,
"&source_content_type=application/json",
"&source=", post_body))
df <- data.table::fread(url, quote = "\"",
colClasses = "character", data.table = FALSE,
showProgress = FALSE, ...)
df
}
productdb <- download_es_data("biz_register_product")
companydb <- productdb %>%
distinct(biz_tax, .keep_all = TRUE) %>%
select(biz_tax, company_name, biz_add, contact_email, contact_phone)
###Get M report structure 2021
ggs_M_report_structure <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=287602844"
M_report_structure <-  read.csv(text = gsheet2text(ggs_M_report_structure, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE) %>%
select(industry_certi_code_r, hvn_survey_id_r, hvn_product_id_r, hvn_survey_keymerge, hvn_M_order)
###Get & join certificate code 2021
ggs_industry_certi_code <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=923897406"
industry_certi_code <-  read.csv(text = gsheet2text(ggs_industry_certi_code, format = 'csv'), fileEncoding = "UTF-8", stringsAsFactors = FALSE, header = TRUE, skip = 3, colClasses = "character")
# This script aim to create market report for HVNCLC 2020
# Purpose      :   Create market report for HVNCLC 2020
# Code         :
# Destination  :   [HVNCLC] Báo cáo TT thị trường khảo sát HVNCLC 2020 (S621)
# Author       :   rta_xuanle
# Editor       :
# Created      :   2019-01-13
# Updated      :   2019-
# Change       :
## IMPORT END - Do not remove or edit this line
## -----------------------------------------------------------------------------
## global setup
rm(list = ls())
knitr::opts_chunk$set(echo = FALSE, comment = "", message = FALSE, warning = FALSE)
options(shiny.sanitize.errors = FALSE, scipen = 999, knitr.kable.NA = "")
Sys.setlocale(category = "LC_ALL", locale = "en_US.UTF-8")
## -----------------------------------------------------------------------------
## load packages
RTA::load_packages(readr, tidyr, dplyr, DT, RTA,
stringr, gsheet, data.table, lubridate)
## -----------------------------------------------------------------------------
download_es_data <- function(index, post_body = "{}", host = "https://es.rta.vn", size = 10000, ...) {
if (missing(index)) {
stop("argument 'index' is not provided", call. = FALSE)
}
url <- URLencode(paste0(host, "/", index,
"/_data?format=csv&size=", size,
"&source_content_type=application/json",
"&source=", post_body))
df <- data.table::fread(url, quote = "\"",
colClasses = "character", data.table = FALSE,
showProgress = FALSE, ...)
df
}
productdb <- download_es_data("biz_register_product")
companydb <- productdb %>%
distinct(biz_tax, .keep_all = TRUE) %>%
select(biz_tax, company_name, biz_add, contact_email, contact_phone)
###Get M report structure 2021
ggs_M_report_structure <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=287602844"
M_report_structure <-  read.csv(text = gsheet2text(ggs_M_report_structure, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE) %>%
select(industry_certi_code_r, hvn_survey_id_r, hvn_product_id_r, hvn_survey_keymerge, hvn_M_order)
###Get & join certificate code 2021
ggs_industry_certi_code <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=923897406"
industry_certi_code <-  read.csv(text = gsheet2text(ggs_industry_certi_code, format = 'csv'), fileEncoding = "UTF-8", stringsAsFactors = FALSE, header = TRUE, skip = 3, colClasses = "character")
## e-form: https://vndemo.rtworkspace.com/webapp/webform/indexV2?familyCode=mwejjzRdt9xAsvr
## xlsform: https://drive.google.com/drive/folders/1OCY9tXmACI_YyMzMMyuQJRLpwgHHk81L
###Get instance list to delete as per BSA request
ggs_voteonline_delete <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=1158660739"
voteonline_delete <-  read.csv(text = gsheet2text(ggs_voteonline_delete, format = 'csv'), fileEncoding = "UTF-8", stringsAsFactors = FALSE)
ggs_voteonline_check_khop <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=660874130"
voteonline_check_khop <-  read.csv(text = gsheet2text(ggs_voteonline_check_khop, format = 'csv'), fileEncoding = "UTF-8", stringsAsFactors = FALSE)
## import data (repeats)
voteonline_survey_product_raw <- get_dm2_data("C1102", "HVN_PRODUCT_VOTE_2023_hvn_choice_rr_official", encoding = "UTF-8") %>%
anti_join(voteonline_delete, by = "instanceID")
## import core data
voteonline_survey_raw <- get_dm2_data("C1102", "HVN_PRODUCT_VOTE_2023_official_CORE") %>%
anti_join(voteonline_delete, by = "instanceID")
## progress data
voteonline_data <- voteonline_survey_raw %>%
filter(!is.na(instanceID) & instanceID != "") %>%
mutate(date = substr(starttime, 1, 10),
fullname = capwords(fullname, strict = TRUE)) %>%
select(instanceID, hvn_survey_id, hvn_survey_lb, starttime_str, submission_date, hvn_screening,
hvn_res_name, hvn_res_gender, hvn_res_gender_lb, hvn_res_age,
hvn_res_edu, hvn_res_edu_lb, hvn_res_income, hvn_res_income_lb, hvn_res_job, hvn_res_job_lb,
hvn_city_id, hvn_city_lb, hvn_district_lb, hvn_commune_lb, hvnadd_detail, hvn_phone, hvn_email, username, fullname,
hvn_m_interest_1, hvn_m_interest_2, hvn_m_interest_3,
hvn_m_interest_1_lb, hvn_m_interest_2_lb, hvn_m_interest_3_lb,
hvn_m_buy_place_1, hvn_m_buy_place_2, hvn_m_buy_place_3,
hvn_m_info_source_1, hvn_m_info_source_2, hvn_m_info_source_3)
voteonline_data_progress_report <- voteonline_data %>%
select(instanceID, starttime_str, submission_date, hvn_screening,
hvn_res_name, hvn_res_gender, hvn_res_gender_lb, hvn_res_age,
hvn_res_edu, hvn_res_edu_lb, hvn_res_income, hvn_res_income_lb, hvn_res_job, hvn_res_job_lb,
hvn_city_id, hvn_city_lb, hvn_district_lb, hvn_commune_lb, hvnadd_detail, hvn_phone, hvn_email,
username, fullname, hvn_survey_id, hvn_survey_lb)
voteonline_survey_product <- voteonline_survey_product_raw %>%
separate_rows(biz_tax, sep = " ") %>%
mutate(instanceID_sub = paste0(instanceID, "_", biz_tax),
hvn_tax_code = biz_tax) %>%
rename(hvn_product_id = hvn_option_id,
hvn_product_lb = hvn_option_lb) %>%
select(instanceID_sub, instanceID, hvn_position2, biz_tax, hvn_tax_code,
hvn_product_id, hvn_product_lb) %>%
mutate(hvn_product_id = case_when(
str_length(hvn_product_id) == 3 ~ paste0("0", hvn_product_id),
TRUE ~ hvn_product_id),
hvn_tax_code = case_when(str_length(hvn_tax_code) == 9 ~ paste0("0", hvn_tax_code),
TRUE ~ hvn_tax_code))
#I add this to by pass error using old command
voteonline_data_full <- voteonline_data  %>%
left_join(voteonline_survey_product, by = "instanceID", multiple = "all") %>%
mutate(hvn_res_name = capwords(hvn_res_name, strict = TRUE)) %>%
filter(!(is.na(hvn_product_id) | hvn_product_id == "")) %>%
left_join(industry_certi_code, by = "hvn_product_id", multiple = "all")  %>%
left_join(companydb, by = "biz_tax") %>%
mutate(hvn_brand_name = company_name)
voteonline_data_product_progress_report <- voteonline_data_full %>%
left_join(companydb, by = "biz_tax") %>%
select(instanceID, username, fullname, hvn_res_name, hvn_position2, hvn_product_id, hvn_product_lb,
hvn_tax_code, hvn_brand_name,
hvn_m_interest_1_lb, hvn_m_interest_2_lb, hvn_m_interest_3_lb,
hvn_m_buy_place_1, hvn_m_buy_place_2, hvn_m_buy_place_3,
hvn_m_info_source_1, hvn_m_info_source_2, hvn_m_info_source_3)
## e-form: https://vndemo.rtworkspace.com/webapp/webform/indexV2?familyCode=hCvCT5E5BsnXY3w
## xlsform: https://drive.google.com/drive/folders/1Spmmbe9Mo4xCwjOv2We2Dyd9tNuf-Er5
##Get instance list to delete as per BSA request
ggs_voteoffline_delete <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=1167862759"
voteoffline_delete <-  read.csv(text = gsheet2text(ggs_voteoffline_delete, format = 'csv'), fileEncoding = "UTF-8", stringsAsFactors = FALSE)
## import data (repeats)
voteoffline_survey_product_raw <- get_dm2_data("C1102", "HVN_PRODUCT_VOTEOFF_2023_hvn_choice_rr_official", encoding = "UTF-8") %>%
anti_join(voteoffline_delete, by = "instanceID")
## import core data
voteoffline_survey_raw <- get_dm2_data("C1102", "HVN_PRODUCT_VOTEOFF_2023_official_CORE") %>%
anti_join(voteoffline_delete, by = "instanceID") %>%
group_by(orig_inst) %>%
arrange(desc(endtime)) %>%
ungroup() %>%
distinct(orig_inst, .keep_all = TRUE)
## progress data
voteoffline_data <- voteoffline_survey_raw %>%
filter(!is.na(instanceID) & instanceID != "") %>%
mutate(date = substr(starttime, 1, 10),
fullname = capwords(fullname, strict = TRUE)) %>%
select(instanceID, hvn_survey_id, hvn_survey_lb, starttime_str, submission_date, hvn_screening,
hvn_res_name, hvn_res_gender, hvn_res_gender_lb, hvn_res_age,
hvn_res_edu, hvn_res_edu_lb, hvn_res_income, hvn_res_income_lb, hvn_res_job, hvn_res_job_lb,
hvn_city_id, hvn_city_lb, hvn_district_lb, hvn_commune_lb, hvnadd_detail, hvn_phone, hvn_email, username, fullname,
hvn_m_interest_1, hvn_m_interest_2, hvn_m_interest_3,
hvn_m_interest_1_lb, hvn_m_interest_2_lb, hvn_m_interest_3_lb,
hvn_m_buy_place_1, hvn_m_buy_place_2, hvn_m_buy_place_3,
hvn_m_info_source_1, hvn_m_info_source_2, hvn_m_info_source_3)
voteoffline_data_progress_report <- voteoffline_data %>%
select(instanceID, starttime_str, submission_date, hvn_screening,
hvn_res_name, hvn_res_gender, hvn_res_gender_lb, hvn_res_age,
hvn_res_edu, hvn_res_edu_lb, hvn_res_income, hvn_res_income_lb, hvn_res_job, hvn_res_job_lb,
hvn_city_id, hvn_city_lb, hvn_district_lb, hvn_commune_lb, hvnadd_detail, hvn_phone, hvn_email,
username, fullname, hvn_survey_id, hvn_survey_lb)
voteoffline_survey_product <- voteoffline_survey_product_raw %>%
separate_rows(biz_tax, sep = " ") %>%
mutate(instanceID_sub = paste0(`_URI`, "_", biz_tax),
`_URI` = `_PARENT_AURI`, hvn_tax_code = biz_tax) %>%
rename(hvn_product_id = hvn_option_id,
hvn_product_lb = hvn_option_lb) %>%
select(instanceID_sub, instanceID, hvn_position2, biz_tax, hvn_tax_code,
hvn_product_id, hvn_product_lb) %>%
mutate(hvn_product_id = case_when(
str_length(hvn_product_id) == 3 ~ paste0("0", hvn_product_id),
TRUE ~ hvn_product_id),
hvn_tax_code = case_when(str_length(hvn_tax_code) == 9 ~ paste0("0", hvn_tax_code),
TRUE ~ hvn_tax_code))
#I add this to by pass error using old command
voteoffline_data_full <- voteoffline_data  %>%
left_join(voteoffline_survey_product, by = "instanceID", multiple = "all") %>%
mutate(hvn_res_name = capwords(hvn_res_name, strict = TRUE)) %>%
filter(!(is.na(hvn_product_id) | hvn_product_id == "")) %>%
left_join(industry_certi_code, by = "hvn_product_id", multiple = "all") %>%
left_join(companydb, by = "biz_tax") %>%
mutate(hvn_brand_name = company_name)
voteoffline_data_product_progress_report <- voteoffline_data_full %>%
left_join(companydb, by = "biz_tax") %>%
select(instanceID, username, fullname, hvn_res_name, hvn_position2, hvn_product_id, hvn_product_lb,
hvn_tax_code, hvn_brand_name,
hvn_m_interest_1_lb, hvn_m_interest_2_lb, hvn_m_interest_3_lb,
hvn_m_buy_place_1, hvn_m_buy_place_2, hvn_m_buy_place_3,
hvn_m_info_source_1, hvn_m_info_source_2, hvn_m_info_source_3)
data_full <- rbind(voteoffline_data_full, voteonline_data_full)
mp_data <- data_full %>%
filter(!duplicated(instanceID)) %>%
mutate(hvn_survey_id_num = as.numeric(hvn_survey_id))
data_long <- gather(map37mp, source, industry_certi_name_eform, hvn_m_interest_1_lb:hvn_m_interest_3_lb,
factor_key=TRUE) %>%
distinct(hvn_survey_id, industry_certi_name_eform)
map37mp <- data_full %>%
select(hvn_survey_id, hvn_m_interest_1_lb, hvn_m_interest_2_lb, hvn_m_interest_3_lb)
data_long <- gather(map37mp, source, industry_certi_name_eform, hvn_m_interest_1_lb:hvn_m_interest_3_lb,
factor_key=TRUE) %>%
distinct(hvn_survey_id, industry_certi_name_eform)
View(data_long)
data_long <- gather(map37mp, source, industry_certi_name_eform, hvn_m_interest_1_lb:hvn_m_interest_3_lb,
factor_key=TRUE) %>%
distinct(hvn_survey_id, industry_certi_name_eform) %>%
filter(str_length(industry_certi_name_eform) > 1)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform")
map37mp <- data_full %>%
select(hvn_survey_id, hvn_m_interest_1_lb, hvn_m_interest_2_lb, hvn_m_interest_3_lb)
data_long <- gather(map37mp, source, industry_certi_name_eform, hvn_m_interest_1_lb:hvn_m_interest_3_lb,
factor_key=TRUE) %>%
distinct(hvn_survey_id, industry_certi_name_eform) %>%
filter(str_length(industry_certi_name_eform) > 1)
ggs_37mp <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=711145776"
db_37mplb <-  read.csv(text = gsheet2text(ggs_37mp, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 30)
View(db_37mplb)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform")
View(temp)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform") %>%
arrange(industry_certi_name_eform)
ggs_37mp <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=711145776"
db_37mplb <-  read.csv(text = gsheet2text(ggs_37mp, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 30)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform") %>%
arrange(industry_certi_name_eform)
ggs_37mp <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=711145776"
db_37mplb <-  read.csv(text = gsheet2text(ggs_37mp, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 30)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform") %>%
arrange(industry_certi_name_eform)
ggs_37mp <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=711145776"
db_37mplb <-  read.csv(text = gsheet2text(ggs_37mp, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 30)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform") %>%
arrange(industry_certi_name_eform)
ggs_37mp <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=711145776"
db_37mplb <-  read.csv(text = gsheet2text(ggs_37mp, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 30)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform") %>%
arrange(industry_certi_name_eform)
ggs_37mp <- "https://docs.google.com/spreadsheets/d/1LTNl1syM0WCPuJ2VHBtgds82cZWGVsKCOFBPAmpDn-o/edit#gid=711145776"
db_37mplb <-  read.csv(text = gsheet2text(ggs_37mp, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 30)
temp <- full_join(db_37mplb, data_long, by = "industry_certi_name_eform") %>%
arrange(industry_certi_name_eform)
View(data_long)
install.packages("av")
RTA::load_packages(readr, dplyr, DT, RTA,
stringr, gsheet, data.table, lubridate, writexl)
# Get report structure
setwd("/Users/ledangtrung/rtGit/rtpublic/HVNCLC/2024-2025/")
ggs_M41_report_structure <- "https://docs.google.com/spreadsheets/d/1ToRqMbCTg7sNrWNoCBnyNw9qI5pv5UJQ/edit?gid=404451953#gid=404451953"
M41_report_structure <-  read.csv(text = gsheet2text(ggs_M41_report_structure, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 0, header = FALSE) %>%
filter(row_number() > 3) %>%
mutate(stt = row_number(),
hvn_survey_id = str_remove(V1, "MP"),
hvn_survey_name = V2,
industry_certi_code = as.numeric(V3),
industry_certi_name = V4,
#choice_name = V5) %>%
#select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_name) %>%
#left_join(m4_choices, join_by(hvn_survey_id==survey_id, choice_name==choice_name))
choice_id = as.numeric(V5),
choice_name = V6) %>%
mutate(choice_id = replace_na(choice_id, 999)) %>%
select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_id, choice_name)
RTA::load_packages(readr, dplyr, DT, RTA,
stringr, gsheet, data.table, lubridate, writexl)
M41_report_structure <-  read.csv(text = gsheet2text(ggs_M41_report_structure, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 0, header = FALSE) %>%
filter(row_number() > 3) %>%
mutate(stt = row_number(),
hvn_survey_id = str_remove(V1, "MP"),
hvn_survey_name = V2,
industry_certi_code = as.numeric(V3),
industry_certi_name = V4,
#choice_name = V5) %>%
#select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_name) %>%
#left_join(m4_choices, join_by(hvn_survey_id==survey_id, choice_name==choice_name))
choice_id = as.numeric(V5),
choice_name = V6) %>%
mutate(choice_id = replace_na(choice_id, 999)) %>%
select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_id, choice_name)
ggs_M41_report_structure <- "https://docs.google.com/spreadsheets/d/1ToRqMbCTg7sNrWNoCBnyNw9qI5pv5UJQ/edit?gid=404451953#gid=404451953"
M41_report_structure <-  read.csv(text = gsheet2text(ggs_M41_report_structure, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 0, header = FALSE) %>%
filter(row_number() > 3) %>%
mutate(stt = row_number(),
hvn_survey_id = str_remove(V1, "MP"),
hvn_survey_name = V2,
industry_certi_code = as.numeric(V3),
industry_certi_name = V4,
#choice_name = V5) %>%
#select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_name) %>%
#left_join(m4_choices, join_by(hvn_survey_id==survey_id, choice_name==choice_name))
choice_id = as.numeric(V5),
choice_name = V6) %>%
mutate(choice_id = replace_na(choice_id, 999)) %>%
select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_id, choice_name)
RTA::load_packages(readr, dplyr, DT, RTA, tidyr,
stringr, gsheet, data.table, lubridate, writexl)
M41_report_structure <-  read.csv(text = gsheet2text(ggs_M41_report_structure, format = 'csv'),
fileEncoding = "UTF-8", stringsAsFactors = FALSE, skip = 0, header = FALSE) %>%
filter(row_number() > 3) %>%
mutate(stt = row_number(),
hvn_survey_id = str_remove(V1, "MP"),
hvn_survey_name = V2,
industry_certi_code = as.numeric(V3),
industry_certi_name = V4,
#choice_name = V5) %>%
#select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_name) %>%
#left_join(m4_choices, join_by(hvn_survey_id==survey_id, choice_name==choice_name))
choice_id = as.numeric(V5),
choice_name = V6) %>%
mutate(choice_id = replace_na(choice_id, 999)) %>%
select(stt, hvn_survey_id, hvn_survey_name, industry_certi_code, industry_certi_name, choice_id, choice_name)
saveRDS(M41_report_structure, "M41_report_structure.rds")
checkdup_M41_report_structure <- M41_report_structure %>%
group_by(hvn_survey_id, industry_certi_code, choice_id) %>%
mutate(dupe = n()>1) %>%
filter(dupe==TRUE)
